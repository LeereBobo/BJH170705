<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" href="index.css" />
	</head>

	<body>

		<div id="wrap" class="wrap_style">
			<ul id="peoples" class="ul_styless">

			</ul>

			<div id="edit" class="display_none">
				<input type="text" id="edit_name" placeholder="请输入姓名" class="fonts" />
				<input type="text" id="edit_tel" placeholder="请输入电话" class="fonts"/>
				<input type="submit" id="sure" />
			</div>
		</div>

		<script src="index.js"></script>
		<script src="pinyin.js"></script>
		<script type="text/javascript">
			var oWrap = document.getElementById("wrap");
			var oUl = document.getElementById("peoples");
			var edit = document.getElementById("edit");
			var edit_name = document.getElementById("edit_name");
			var edit_tel = document.getElementById("edut_tel");
			var sure = document.getElementById("sure");
			//第一步：进行网络请求
			ajax("./data.php", function(value) {
					var obj = JSON.parse(value);
					createPage(obj);
				})
			//第二步：创建页面
			function createPage(data) {
				for (var i = 0; i < data.length; i++) {
					//首字母、电话、姓名的父级
					var lis = create("li", oUl, "lis_style");
					//首字母
					var letter_div = create("div", lis, "letter_style");
					letter_div.innerHTML = data[i].letter;
					var peoples_data = data[i].peoples;
					for (var j = 0; j < peoples_data.length; j++) {
						//创建姓名、电话
						var name_tel = create("div", lis, "float_clear name_tel_style");
						var name_div = create("div", name_tel, "float_left name_style");
						name_div.innerHTML = peoples_data[j].name;
						var tel_div = create("div", name_tel, "float_left tel_style");
						tel_div.innerHTML = peoples_data[j].tel;
						var datas = peoples_data[j];
						//删除按钮
						createDelete(name_tel, datas, data[i], lis);
						
						//点击进入编辑界面
						name_div.onclick = function() {
							oUl.className = "display_none";
							edit.className = "display_block";
							edit_name.value = this.innerHTML;
							edit_tel.value = datas.tel;
						}
					}
				}
			}
			
			
			//添加删除按钮
			function createDelete(father, singel, dataValue, myli) {
				var delete_btn = create("div", father, "float_right");
				delete_btn.innerHTML = "删除";
				delete_btn.fath1 = dataValue;
				delete_btn.fath2 = singel;
				delete_btn.delletter = myli;
				delete_btn.onclick = function() {
					//修改界面，删除当前人物信息
					this.parentNode.parentNode.removeChild(this.parentNode);
					//修改数组，获取所删元素的下标
					var index = this.fath1.peoples.indexOf(this.fath2);
					this.fath1.peoples.splice(index, 1);
					console.log(this.fath1.peoples);
					//判断letter里length为0时，删除letter
					if (this.fath1.peoples.length == 0) {
						oUl.removeChild(this.delletter);
					}
					
					
				}
			}
			
			//编辑确认界面
			sure.onclick = function(){
				this.inputValue.name = edit_name.value;
				this.inputValue.tel = edit_tel.value;
			}
			
		</script>
	</body>

</html>